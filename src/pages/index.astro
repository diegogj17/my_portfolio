---
import MainLayout from '../layouts/MainLayout.astro';
import ProjectCard from '../layouts/ProjectCard.astro';

// Obtener proyectos de GitHub de manera segura
let githubProjects = [];
try {
  const response = await fetch(`https://api.github.com/users/diegogj17/repos?sort=updated&per_page=10`);
  if (response.ok) {
    githubProjects = await response.json();
  }
} catch (error) {
  console.error("Error fetching GitHub repos:", error);
}

// Formatear los proyectos de GitHub de manera segura - mostrar los 3 más recientes
const formattedGithubProjects = githubProjects.slice(0, 3).map((repo: { name: any; description: any; topics: any; language: any; html_url: any; stargazers_count: any; }) => ({
  title: repo.name || 'Proyecto sin título',
  description: repo.description || 'Sin descripción disponible',
  technologies: repo.topics && Array.isArray(repo.topics) ? 
    repo.topics : 
    (repo.language ? [repo.language] : []),
  link: repo.html_url || '#',
  isGithub: true,
  stars: repo.stargazers_count || 0,
  language: repo.language || ''
}));

// Proyectos a mostrar
const allProjects = formattedGithubProjects;
---

<MainLayout title="Inicio | Mi Portfolio">
  <section class="hero">
    <div class="hero-container">
      <div class="hero-content">
        <h1>¡Hola, soy Diego!</h1>
        <p class="lead">Desarrollador Backend</p>
        <p class="hero-description">
          Bienvenido a mi portfolio. Aquí encontrarás mis proyectos, habilidades y experiencias
          como desarrollador.
        </p>
        <div class="hero-buttons">
          <a href="/proyectos" class="btn">Ver mis proyectos</a>
          <a href="/contact" class="btn">Contact Me</a>
        </div>
      </div>
    </div>
  </section>

  <section class="featured-projects">
    <div class="container">
      <h2>Proyectos más recientes</h2>
      <div class="projects-row">
        {allProjects.map((project: { title: string; description: string; technologies: any; link: string; isGithub: any; stars: number | undefined; language: string | undefined; }) => (
          <ProjectCard
            title={project.title}
            description={project.description}
            technologies={project.technologies || []}
            link={project.link}
            isGithub={project.isGithub || false}
            stars={project.stars}
            language={project.language}
          />
        ))}
      </div>
      <div class="view-more">
        <a href="/proyectos" class="btn btn-outline">Ver más proyectos</a>
        <a href="https://github.com/diegogj17" target="_blank" class="btn btn-github">
          <span>Ver mi GitHub</span>
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 0a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2.2c-3.3.7-4-1.4-4-1.4-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.4 1 .1-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.7 1.7.2 2.9.1 3.2.8.8 1.3 1.9 1.3 3.2 0 4.6-2.9 5.6-5.5 5.9.4.4.8 1.1.8 2.2v3.3c0 .3.2.7.8.6A12 12 0 0 0 12 0z"></path></svg>
        </a>
      </div>
    </div>
  </section>
</MainLayout>