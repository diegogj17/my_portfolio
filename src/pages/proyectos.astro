---
import MainLayout from '../layouts/MainLayout.astro';
import ProjectCard from '../layouts/ProjectCard.astro';

// Proyectos destacados manualmente (definidos primero para evitar errores)
const featuredProjects = [
  {
    title: "Thumble",
    description: "Una aplicación para compartir y descubrir contenido visual.",
    technologies: ["Node.js", "Express", "MongoDB", "React"],
    link: "https://github.com/diegogj17/thumble",
    isGithub: true,
    isFeatured: true
  },
  {
    title: "Portfolio Personal",
    description: "Mi sitio web personal y portfolio construido con Astro.",
    technologies: ["Astro", "JavaScript", "CSS", "HTML"],
    link: "https://github.com/diegogj17/my_portfolio",
    isGithub: true,
    isFeatured: true
  }
];

// Obtener todos los proyectos de GitHub de manera segura
let githubProjects = [];
try {
  const response = await fetch(`https://api.github.com/users/diegogj17/repos?sort=updated&per_page=10`);
  if (response.ok) {
    githubProjects = await response.json();
  }
} catch (error) {
  console.error("Error fetching GitHub repos:", error);
}

// Filtrar los proyectos de GitHub para excluir los destacados
const filteredGithubProjects = githubProjects.filter(repo => {
  // Solo incluir si no está en los proyectos destacados
  return !featuredProjects.some(fp => 
    fp.title.toLowerCase() === repo.name.toLowerCase() || 
    fp.link.includes(repo.name.toLowerCase())
  );
});

// Formatear los proyectos filtrados de GitHub de manera segura
const formattedGithubProjects = filteredGithubProjects.map(repo => ({
  title: repo.name || 'Proyecto sin título',
  description: repo.description || 'Sin descripción disponible',
  technologies: (repo.topics && Array.isArray(repo.topics)) ? 
    repo.topics : 
    (repo.language ? [repo.language] : []),
  link: repo.html_url || '#',
  isGithub: true,
  stars: repo.stargazers_count || 0,
  language: repo.language || '',
  isFeatured: false
}));
---

<MainLayout title="Proyectos Destacados | Mi Portfolio">
  <section class="projects-header">
    <div class="container">
      <h1>Proyectos Destacados</h1>
      <p class="lead">Una colección de mis mejores trabajos y proyectos de código abierto</p>
    </div>
  </section>

  <section class="featured-section">
    <div class="container">
      <h2>Proyectos seleccionados</h2>
      <div class="projects-grid">
        {featuredProjects.map(project => (
          <ProjectCard
            title={project.title}
            description={project.description}
            technologies={project.technologies || []}
            link={project.link}
            isGithub={project.isGithub || false}
            stars={project.stars}
            language={project.language}
            isFeatured={true}
          />
        ))}
      </div>
    </div>
  </section>

  <section class="all-projects-section">
    <div class="container">
      <h2>Otros proyectos</h2>
      <div class="projects-grid">
        {formattedGithubProjects.slice(0, 6).map(project => (
          <ProjectCard
            title={project.title}
            description={project.description}
            technologies={project.technologies || []}
            link={project.link}
            isGithub={project.isGithub || false}
            stars={project.stars}
            language={project.language}
          />
        ))}
      </div>

      <div class="github-cta">
        <p>¿Quieres ver más de mis proyectos?</p>
        <a href="https://github.com/diegogj17" target="_blank" class="btn btn-github">
          <span>Visita mi GitHub</span>
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M12 0a12 12 0 0 0-3.8 23.4c.6.1.8-.3.8-.6v-2.2c-3.3.7-4-1.4-4-1.4-.6-1.4-1.4-1.8-1.4-1.8-1-.7.1-.7.1-.7 1.2 0 1.9 1.2 1.9 1.2 1 1.8 2.8 1.3 3.4 1 .1-.8.4-1.3.7-1.6-2.7-.3-5.5-1.3-5.5-6 0-1.2.5-2.3 1.3-3.1-.2-.4-.6-1.6 0-3.2 0 0 1-.3 3.4 1.2a11.5 11.5 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.7 1.7.2 2.9.1 3.2.8.8 1.3 1.9 1.3 3.2 0 4.6-2.9 5.6-5.5 5.9.4.4.8 1.1.8 2.2v3.3c0 .3.2.7.8.6A12 12 0 0 0 12 0z"></path></svg>
        </a>
      </div>
    </div>
  </section>
</MainLayout>

<style>
  .projects-header {
    padding: 4rem 0 2rem;
    text-align: center;
    background-color: var(--background-gradient-start, #f5f5f5);
  }

  .projects-header h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .projects-header .lead {
    font-size: 1.25rem;
    max-width: 700px;
    margin: 0 auto;
    color: var(--text-secondary, #555);
  }

  .featured-section,
  .all-projects-section {
    padding: 3rem 0;
  }

  .featured-section {
    background-color: var(--background-light, #f9f9f9);
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin: 2rem 0;
  }

  .github-cta {
    text-align: center;
    margin-top: 3rem;
  }

  .github-cta p {
    margin-bottom: 1rem;
    font-size: 1.1rem;
  }
</style>
